<!DOCTYPE html>
<html lang = "en">
<head>
	<meta charset="utf-8" />
	<title>Invent√°rio</title>
	<link rel="stylesheet" href="css/style.css" media="all">
</head>
<body>
	<header>
		<figure>
			<img id="logo" src="img/logo.png"/>
		</figure>
		<figure>
			<a id="save"><img src="img/logo.png"/></a>
		</figure>
	</header>
	<div id="screenshot">
		<div class="top-frame"></div>
		<div class="bottom-frame"></div>
		<div class="left-frame"></div>
		<div class="right-frame"></div>
		<div id='icon-layer'>
		</div>
			<figure>
				<img id="background" src="" alt="background" width="2560px"/>
			</figure>
	</div>
	<script src="html2canvas.js"></script>
	<script>

	(function(){

		//BACKGROUND IMAGE//

		var bgImage = document.getElementById("background");

		randomizeBg = function() {
			var randomBgNumber = Math.round(Math.random() * 4);
			bgImage.setAttribute('src', 'img/bg-' + randomBgNumber + '.jpg');
		}

		randomizeBg();

		//RANDOM ICON//

	  	var placeNewIcon = function(e) {

	  		_x = e.pageX;
	 		_y = e.pageY;
	 		var newIcon = document.createElement('img');
	 		var randomIconNumber = Math.round(Math.random() * 4);
	 		newIcon.setAttribute('src', 'img/icon-' + randomIconNumber + '.png');
	 		newIcon.setAttribute('class', 'icon');
	 		newIcon.setAttribute('style', 'top: ' + (_y - 120) + 'px; left: ' + (_x - 150) + 'px; z-index: ' + _y);
	 		var iconLayer = document.getElementById('icon-layer');
	 		iconLayer.appendChild(newIcon);
	  	}

	  	bgImage.addEventListener('click', placeNewIcon);

	  	//SAVE SCREENSHOT

	  	var savedContent = document.getElementById("screenshot");

	  	var savingButton = document.getElementById("save");
		 
		var generatePng = function()  {

			var btn = this;

	  		var usableHeight = window.innerHeight;
	  		var usableWidth = window.innerWidth;

			html2canvas(savedContent, {
				width: usableWidth,
		        height: usableHeight,
		        taintTest: true,
		        onrendered: function(canvas) {
		        	btn.href = canvas.toDataURL();
		        	btn.download = "download.png";
		        }
		    }) 
		}
		
		savingButton.addEventListener('click', generatePng);


	})()
	</script>
</body>
</html>
